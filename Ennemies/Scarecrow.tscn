[gd_scene load_steps=10 format=3 uid="uid://vbwrldk3i16e"]

[ext_resource type="Script" uid="uid://c4lylp40sxdo0" path="res://Ennemies/Scarecrow.gd" id="1_tl5ag"]
[ext_resource type="Texture2D" uid="uid://d0ovc83hmo14j" path="res://ArtCard/Scarecrow.png" id="2_ydfl1"]
[ext_resource type="Script" uid="uid://d3yl2mqdykp0j" path="res://Utility/CustomType/CPolygon2D.gd" id="3_v4ya1"]
[ext_resource type="PackedScene" uid="uid://ca0b1qo2v7edf" path="res://Utility/CustomNode/Health.tscn" id="5_cpyhq"]
[ext_resource type="PackedScene" uid="uid://bch12dvchox3r" path="res://Utility/CustomNode/Hurtbox2D.tscn" id="6_x6itp"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_3jxnb"]
radius = 53.0
height = 134.0

[sub_resource type="Theme" id="Theme_xl5xg"]
resource_local_to_scene = true

[sub_resource type="GDScript" id="GDScript_1xilp"]
resource_local_to_scene = true
script/source = "extends Resource

signal healthChanged(nHealth : int)
signal healthDropZero(infoHp : Resource)

@export var visibleHpBar : bool
@export var health : int : set = setHealth, get = getHealth
@export var maxHealth : int : set = setMaxHealth, get = getMaxHealth

var _health : int = 0
var _maxHealth : int = 0

func heal(nHeal: int) -> void:
	health += nHeal

func takeDamage(damage: int) -> void:
	health = _health - damage
		
# not emitting healthChanged
func setHealth(nHealth: int) -> void:
	_health = clampi(nHealth, 0, maxHealth)
	if health == 0:
		healthDropZero.emit(self)
	else:
		healthChanged.emit(_health)
	
func getHealth() -> int:
	return _health

func setMaxHealth(nMaxHealth: int) -> void:
	var diffHealth : int = nMaxHealth - _maxHealth
	_maxHealth = nMaxHealth
	health = _health + diffHealth
	
func getMaxHealth() -> int:
	return _maxHealth
"

[sub_resource type="Resource" id="Resource_0uo01"]
resource_local_to_scene = true
script = SubResource("GDScript_1xilp")
visibleHpBar = true
health = 60
maxHealth = 100
metadata/_custom_type_script = "uid://c8yac8xqlpbwr"

[node name="Scarecrow" type="Node2D"]
script = ExtResource("1_tl5ag")

[node name="Sprite2D" type="Sprite2D" parent="."]
scale = Vector2(10, 10)
texture = ExtResource("2_ydfl1")

[node name="MovementBox" type="Polygon2D" parent="."]
visible = false
position = Vector2(-1.52542, 0)
scale = Vector2(1.05085, 1)
color = Color(1, 1, 1, 0)
polygon = PackedVector2Array(-14, -40, 13, -41, 30, -21, 21, 42, 20, -20, -29, -20)
script = ExtResource("3_v4ya1")

[node name="Timer" type="Timer" parent="."]
wait_time = 2.0
one_shot = true

[node name="HurtBox" parent="." instance=ExtResource("6_x6itp")]

[node name="CollisionShape2D" parent="HurtBox" index="0"]
shape = SubResource("CapsuleShape2D_3jxnb")

[node name="Health" parent="." instance=ExtResource("5_cpyhq")]
offset_left = -99.0
offset_top = -119.0
offset_right = 101.0
offset_bottom = -94.0
theme = SubResource("Theme_xl5xg")
info = SubResource("Resource_0uo01")

[connection signal="takeHit" from="HurtBox" to="Health" method="_on_hurt_box_take_hit"]
[connection signal="healthDropZero" from="Health" to="." method="_on_health_health_drop_zero"]

[editable path="HurtBox"]
